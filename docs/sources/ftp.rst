=====================
ftp服务器配置学习笔记
=====================

.. contents::

使用的ftp服务器为vsftpd。

安装和启动
==========

::

  # emerge vsftpd
  # /etc/init.d/vsftpd start
  # rc-update add vsftpd


遇到的问题
==========

500 OOPS: vsftpd: refusing to run with writable root inside chroot()
--------------------------------------------------------------------

gentoo下，vsftpd匿名用户的默认目录是/home/ftp，按照gentoo wiki上的将其
修改为标准的/var/ftp，

::

  # rmdir /home/ftp
  # mkdir /var/ftp
  # chown ftp:ftp /var/ftp
  
并将/etc/passwd中ftp用户的目录改为/var/ftp。

但是问题出现了，用chrome登陆时需要提供用户名和密码，用命令行登陆时提示如下错误：

::

  500 OOPS: vsftpd: refusing to run with writable root inside chroot()


google了一翻，找到了问题所在:

::

  原来是为了避免一个安全漏洞，从 vsftpd 2.3.5 开始，chroot 目录必须不可写

查看了一下，的确是

::

  # ls -l /var/ | grep ftp
  drwxr-xr-x  2 ftp  ftp  4096 Oct 18 21:10 ftp

将其写权限取消

::

  # chmod u-w /var/ftp
  # ls -l /var/ | grep ftp
  dr-xr-xr-x  2 ftp  ftp  4096 Oct 18 21:10 ftp


OK，问题解决！

参考资料
========

- `gentoo wiki vsftpd <http://en.gentoo-wiki.com/wiki/Vsftpd>`_

