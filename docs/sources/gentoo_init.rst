==========================
gentoo系统启动过程学习笔记
==========================

.. contents::

参考
====

http://www.gentoo.org/doc/en/handbook/handbook-x86.xml?part=2&chap=4

启动过程
========

bios->grub->kernel->init

init会按照/etc/inittab中的指示执行/etc/init.d/中的脚本。

/etc/runlevels/下的子目录中定义一些运行级别，这些子目录中都是一些软链接，链接至/etc/init.d/目录下的脚本。

::

  forfun@mygentoo ~ $ ls /etc/runlevels/
  boot  default  shutdown  sysinit
  forfun@mygentoo ~ $ ls /etc/runlevels/sysinit/ -l
  total 0
  lrwxrwxrwx 1 root root 17 Dec 27  2011 devfs -> /etc/init.d/devfs
  lrwxrwxrwx 1 root root 17 Dec 27  2011 dmesg -> /etc/init.d/dmesg
  lrwxrwxrwx 1 root root 18 Oct 22 16:51 sysfs -> //etc/init.d/sysfs
  lrwxrwxrwx 1 root root 30 Oct 22 16:51 tmpfilesd.sysinit -> //etc/init.d/tmpfilesd.sysinit
  lrwxrwxrwx 1 root root 16 Dec 27  2011 udev -> /etc/init.d/udev
  forfun@mygentoo ~ $ 

gentoo中有7个运行级别，包括3个内部使用的运行级别(sysinit,shutdown和reboo)和4个用户定义的运行级别(boot,default,nonetwork和single)。
  
下面是/etc/inittab的内容：
::

  # 设置默认的运行级
  # Default runlevel.
  id:3:initdefault:

  # 执行/etc/runlevels/sysinit/下的脚本
  # System initialization, mount local filesystems, etc.
  si::sysinit:/sbin/rc sysinit

  # 执行/etc/runlevels/boot/下的脚本
  # Further system initialization, brings up the boot runlevel.
  rc::bootwait:/sbin/rc boot

  # 定义各种运行级别
  l0:0:wait:/sbin/rc shutdown 
  l0s:0:wait:/sbin/halt -dhp
  l1:1:wait:/sbin/rc single
  l2:2:wait:/sbin/rc nonetwork
  l3:3:wait:/sbin/rc default
  l4:4:wait:/sbin/rc default
  l5:5:wait:/sbin/rc default
  l6:6:wait:/sbin/rc reboot
  l6r:6:wait:/sbin/reboot -dk
  #z6:6:respawn:/sbin/sulogin

  # new-style single-user
  su0:S:wait:/sbin/rc single
  su1:S:wait:/sbin/sulogin

  # 初始化终端
  # TERMINALS
  c1:12345:respawn:/sbin/agetty 38400 tty1 linux
  c2:2345:respawn:/sbin/agetty 38400 tty2 linux
  c3:2345:respawn:/sbin/agetty 38400 tty3 linux
  c4:2345:respawn:/sbin/agetty 38400 tty4 linux
  c5:2345:respawn:/sbin/agetty 38400 tty5 linux
  c6:2345:respawn:/sbin/agetty 38400 tty6 linux

  # SERIAL CONSOLES
  #s0:12345:respawn:/sbin/agetty 115200 ttyS0 vt100
  #s1:12345:respawn:/sbin/agetty 115200 ttyS1 vt100

  # What to do at the "Three Finger Salute".
  ca:12345:ctrlaltdel:/sbin/shutdown -r now

  # Used by /etc/init.d/xdm to control DM startup.
  # Read the comments in /etc/init.d/xdm for more
  # info. Do NOT remove, as this will start nothing
  # extra at boot if /etc/init.d/xdm is not added
  # to the "default" runlevel.
  x:a:once:/etc/X11/startDM.sh

